Sector Regime Engine (Non-Destructive Add-On)
CONTEXT (READ CAREFULLY)

You are working inside an existing production-grade stock analysis app called Deep Dive Stock OS.

Tech Stack

Next.js (App Router)

TypeScript

Tailwind CSS

Runs fully in Replit

CRITICAL CONSTRAINTS (NON-NEGOTIABLE)

‚ùå DO NOT modify existing Strategic or Tactical engines

‚ùå DO NOT change scoring, thresholds, or status logic

‚ùå DO NOT refactor Market Context logic

‚ùå DO NOT change any existing API contracts

‚ùå DO NOT rename existing files or types

This prompt only adds a new engine and new metadata.

OBJECTIVE (ONE PURPOSE ONLY)

Create a Sector Regime Engine that evaluates sector-level market conditions and labels each sector as:

FAVORED

NEUTRAL

AVOID

This engine:

Does not affect scores yet

Does not upgrade/downgrade stocks yet

Exists purely as additional intelligence for Phase 2

HIGH-LEVEL DESIGN

The Sector Regime Engine is:

Top-down

Slow-moving (weekly cadence)

Explainable

Independent from stock logic

It evaluates sectors, not individual stocks.

FILES TO CREATE (ONLY THESE)
1Ô∏è‚É£ Sector regime engine
server/domain/sectorRegime/sectorRegimeEngine.ts

2Ô∏è‚É£ Sector types
shared/types/sectorRegime.ts

3Ô∏è‚É£ Sector constants (ETF mapping)
shared/constants/sectors.ts


‚ùå Do not modify any existing files unless explicitly stated below.

TYPE DEFINITIONS (EXACT)
üìç shared/types/sectorRegime.ts

Create the following:

export type SectorRegime = "FAVORED" | "NEUTRAL" | "AVOID";
export type SectorConfidence = "HIGH" | "MEDIUM" | "LOW";

export interface SectorRegimeResult {
  sector: string;
  regime: SectorRegime;
  confidence: SectorConfidence;
  reasons: string[];
  evaluatedAt: Date;
}

SECTOR UNIVERSE (STATIC, SAFE)
üìç shared/constants/sectors.ts

Create a simple mapping:

export const SECTOR_ETFS: Record<string, string> = {
  TECHNOLOGY: "XLK",
  SEMICONDUCTORS: "SMH",
  HEALTHCARE: "XLV",
  CONSUMER_STAPLES: "XLP",
  CONSUMER_DISCRETIONARY: "XLY",
  FINANCIALS: "XLF",
  INDUSTRIALS: "XLI",
  ENERGY: "XLE",
  UTILITIES: "XLU",
};


This is metadata only.
No trading logic depends on this yet.

SECTOR REGIME ENGINE LOGIC
üìç server/domain/sectorRegime/sectorRegimeEngine.ts

Create a pure evaluation function:

import { SectorRegimeResult } from "@shared/types/sectorRegime";

interface SectorInputs {
  relativeStrength: "UP" | "FLAT" | "DOWN";
  trendHealth: "STRONG" | "NEUTRAL" | "WEAK";
  volatility: "LOW" | "NORMAL" | "HIGH";
  macroAlignment: "TAILWIND" | "NEUTRAL" | "HEADWIND";
}

export function evaluateSectorRegime(
  sector: string,
  inputs: SectorInputs
): SectorRegimeResult {
  let score = 0;
  const reasons: string[] = [];

  if (inputs.relativeStrength === "UP") {
    score += 1;
    reasons.push("Sector outperforming market");
  } else if (inputs.relativeStrength === "DOWN") {
    score -= 1;
    reasons.push("Sector underperforming market");
  }

  if (inputs.trendHealth === "STRONG") {
    score += 1;
    reasons.push("Sector trend structurally strong");
  } else if (inputs.trendHealth === "WEAK") {
    score -= 1;
    reasons.push("Sector trend weakening");
  }

  if (inputs.volatility === "HIGH") {
    score -= 1;
    reasons.push("Sector volatility elevated");
  } else if (inputs.volatility === "LOW") {
    score += 1;
    reasons.push("Sector volatility stable");
  }

  if (inputs.macroAlignment === "TAILWIND") {
    score += 1;
    reasons.push("Macro environment supportive");
  } else if (inputs.macroAlignment === "HEADWIND") {
    score -= 1;
    reasons.push("Macro environment unsupportive");
  }

  let regime: "FAVORED" | "NEUTRAL" | "AVOID";
  let confidence: "HIGH" | "MEDIUM" | "LOW";

  if (score >= 2) {
    regime = "FAVORED";
    confidence = score >= 3 ? "HIGH" : "MEDIUM";
  } else if (score <= -2) {
    regime = "AVOID";
    confidence = score <= -3 ? "HIGH" : "MEDIUM";
  } else {
    regime = "NEUTRAL";
    confidence = "MEDIUM";
  }

  return {
    sector,
    regime,
    confidence,
    reasons,
    evaluatedAt: new Date(),
  };
}

INTEGRATION RULE (VERY IMPORTANT)

‚ùå Do NOT plug this into Strategic or Tactical engines yet

‚ùå Do NOT alter scoring or statuses

‚úÖ This engine should be callable independently

‚úÖ Future phases will consume this output

For now, this is read-only intelligence.

OPTIONAL (SAFE) ‚Äî DEBUG EXPOSURE

If a debug or admin route exists, you may:

Expose sector regime results in logs

Or return mock sector regimes for inspection

But do not surface it in the main UI yet.

VALIDATION CHECKLIST (YOU MUST VERIFY)

After running this prompt:

App still builds and runs

Strategic & Tactical behavior is unchanged

No scores or statuses regress

You can call evaluateSectorRegime() independently

Sector regime results include:

sector

regime

confidence

reasons

If any existing logic changes, the prompt failed.

END OF PROMPT